---
id: gitops-concept
title: GitOps 개념 및 도구
date: 2022-01-19
summary: GitOps의 개념에 대해 알아보고 가장 유명한 도구인 ArgoCD와 Flux의 장단점을 비교해본다.
topic: kubernetes
published: false
tags:
  - kubernetes
  - gitops
  - flux
  - argocd
---
## GitOps?
GitOps는 git을 선언적 인프라 및 어플리케이션의 단일 정보 소스로 사용하는 개념이다. 이렇게 쓰면 말이 좀 어렵고 그냥 git에 써있는 상태를 현재 인프라 및 어플리케이션의 상태로 한다는 말이다.

2가지 정도 크게 다가오는 장점이 있는 것 같다.

1. 따로 이력관리를 하지 않아도 git을 통해 이력을 관리할 수 있다.
2. 문서로 단순화할 수 있기 때문에 휴먼 에러를 줄일 수 있다.

두번째는 IaC 의 장점이고 GitOps가 IaC의 한 방법이라고 할 수 있어서 따라오는 느낌이고 사실 첫번째가 정말 크게 다가왔다. 실수를 반복하지 않기 위해서라도 꼭 기록을 남겨야한다. 보통 Kubernetes에 CD 부분을 잘라서 이야기하는 개념인데 유명한 툴들이 있어서 비교 해보면서 이야기 해보면 좋을 것 같다.

## ArgoCD

### 장점
가장 큰 장점은 Web UI가 아주 잘 돼있다는 점이다. 현재 k8s Object의 상태와 Sync 상태를 확인하고 새로운 Application을 만드는 등 많은걸 이 Web UI를 통해 직관적으로 처리할 수 있다. 거기에 cli도 지원하기 때문에 만약 Web UI에서 하기 불편한 반복작업 같은게 있다면 cli로도 처리 가능하기 때문에 접근성은 확실한 강점인 것 같다.

사람들이 많이 쓴다. 처음에는 별거 아니라고 생각을 많이 했는데 일을 오래 하면 할수록 이만큼 중요한 장점이 없는 것 같다. 불편한점이 없는 도구는 없는데 많은 사람들이 사용하면 그만큼 불편이 개선될 여지도 많고 나보다 먼저 삽질을 해둔 사람이 많아서 효율적으로 문제를 해결해 나갈 수 있다.

설치가 간편하다는것도 장점이다. 물론 실제 사용을 하려면 조금 손을 봐줘야 하기는 하지만 Helm 차트 하나 배포하면 기본적으로는 설치가 된다.

### 단점
standalone 형태는 없다. 따로 띄우려고 해도 설정을 etcd에 저장하기 때문에 k8s 클러스터에 Argo CD를 하나 띄워놓고 0개까지 레플리카를 없앤 후 거기에 연결한다. 사실상 k8s 클러스터 없이는 사용이 불가능하다는 말이다. k8s는 버전업이 잦은데 안정성 문제 때문에 클러스터 자체를 교체하는 형식으로 클러스터 버전을 바꾸는 등 클러스터 자체를 자주 교체하는 환경에서는 계속해서 옮겨줘야하는 단점이 있을 것 같다. 백업을 통해 현재 설정을 yaml로 받고 restore 할 수 있기 때문에 치명적이진 않지만 따로 관리해줄 수 없다는 점은 단점이다.

## Flux

### 장점
git repo에 현재 상태를 저장해두고 쓴다. Argo와 다르게 상태가 클러스터 종속적이지 않다. 물론 클러스터를 옮긴다면 Flux를 다시 설치해야 하지만 설정은 git으로만 관리하기 때문에 클러스터에 크게 종속적이진 않다.

### 단점
Argo 처럼 web ui가 잘 돼있지는 않다. DevOps관점에서는 cli 사용이 그렇게 큰 단점은 아닌데 모니터링해야하는 다른 개발자들 입장에서는 조금 불편할 수 있을 것 같다. 그렇다고 없는건 아니라서 어느정도는 커버가 가능할 것 같다.

유연성이 좀 떨어질 수 있을 것 같은데 이건 장단점이 확실히 있을 것 같다. ArgoCD의 경우는 Application이라는 추상화를 한번 거치기 때문에 컨트롤이 가능한 부분이 있는데 Flux는 이런 추상화 단계가 없기 떄문에 git 자체를 polling하고 적용해서 유연성이 좀 떨어질 수 있을 것 같다. 이게 git을 진짜 그대로 반영하는 GitOps 개념과는 딱 맞아 떨어져서 장점이 될 수도 있는데 실제 라이브 서비스에서 단점으로 작용할 여지가 더 많은 것 같다는게 개인적인 생각이다.
